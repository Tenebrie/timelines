enum WorldCalendarType {
    COUNTUP
    EARTH
    PF2E
    RIMWORLD
    EXETHER
}

enum WorldAccessMode {
    Private
    PublicRead
    PublicEdit
}

enum WorldEventType {
    SCENE
    OTHER
}

enum WorldEventField {
    EventIcon
    TargetActors
    MentionedActors
    ExternalLink
}

model World {
    id        String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    name       String
    actors     Actor[]
    events     WorldEvent[]
    calendar   WorldCalendarType @default(COUNTUP)
    timeOrigin BigInt            @default(0)

    owner            User                @relation(fields: [ownerId], references: [id], onDelete: Cascade)
    ownerId          String
    accessMode       WorldAccessMode     @default(Private)
    collaborators    CollaboratingUser[]
    worldEventTracks WorldEventTrack[]
}

model WorldEvent {
    id        String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    type         WorldEventType
    icon         String            @default("default")
    name         String
    timestamp    BigInt
    revokedAt    BigInt?
    description  String            @default("")
    customName   Boolean           @default(false)
    externalLink String            @default("")
    extraFields  WorldEventField[]

    world             World            @relation(fields: [worldId], references: [id], onDelete: Cascade)
    track             WorldEventTrack? @relation(fields: [worldEventTrackId], references: [id], onDelete: Cascade)
    worldId           String
    worldEventTrackId String?

    targetActors     Actor[] @relation("EventTargetActors")
    mentionedActors  Actor[] @relation("EventMentionedActors")
    introducedActors Actor[] @relation(name: "EventIntroducedActors")
    terminatedActors Actor[] @relation(name: "EventTerminatedActors")

    deltaStates WorldEventDelta[]
}

model WorldEventDelta {
    id        String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt
    timestamp BigInt

    name        String?
    description String?

    worldEventId String
    worldEvent   WorldEvent @relation(fields: [worldEventId], references: [id], onDelete: Cascade)
}

model WorldEventTrack {
    id        String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    name     String
    position Int
    visible  Boolean @default(true)

    world   World  @relation(fields: [worldId], references: [id], onDelete: Cascade)
    worldId String

    events WorldEvent[]
}
