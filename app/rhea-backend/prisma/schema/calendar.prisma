model Calendar {
    id        String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt
    position  Int

    originTime BigInt @default(0)

    name        String
    units       CalendarUnit[]
    scaleLevels CalendarScaleLevel[]
    calendarSeasons CalendarSeason[]

    dateFormat String?

    // A calendar is owned by either a world or a user, and never both
    world           World?           @relation(fields: [worldId], references: [id], onDelete: Cascade)
    owner           User?            @relation(fields: [ownerId], references: [id], onDelete: Cascade)
    worldId         String?
    ownerId         String?
}

model CalendarUnit {
    id        String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt
    position  Int

    name              String
    displayName       String?
    displayNameShort  String?
    displayNamePlural String?

    formatMode      CalendarUnitFormatMode     @default(Name)
    formatShorthand String?
    negativeFormat  CalendarUnitNegativeFormat @default(MinusSign)

    duration  Int @default(1)
    treeDepth Int @default(1)

    calendar   Calendar @relation(fields: [calendarId], references: [id], onDelete: Cascade)
    calendarId String

    parents  CalendarUnitRelation[] @relation("ChildUnit")
    children CalendarUnitRelation[] @relation("ParentUnit")
}

model CalendarUnitRelation {
    id        String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    label    String?
    repeats  Int     @default(1)
    position Int

    parentUnit   CalendarUnit @relation("ParentUnit", fields: [parentUnitId], references: [id], onDelete: Cascade)
    childUnit    CalendarUnit @relation("ChildUnit", fields: [childUnitId], references: [id], onDelete: Cascade)
    parentUnitId String
    childUnitId  String
}

enum CalendarUnitFormatMode {
    // Month 0
    Name
    // Month 1
    NameOneIndexed
    // 0
    Numeric
    // 1
    NumericOneIndexed
    // Not displayed
    Hidden
}

enum CalendarUnitNegativeFormat {
    MinusSign
    AbsoluteValue
}

/**
 * Scale levels
 */
model CalendarScaleLevel {
    id        String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt
    position  Int

    name        String
    description String?

    scaleFactor Float @default(1.0)

    calendar   Calendar @relation(fields: [calendarId], references: [id], onDelete: Cascade)
    calendarId String
}

/**
 * Seasons
 */
model CalendarSeason {
    id        String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt
    position  Int

    name        String
    description String?

    calendar   Calendar @relation(fields: [calendarId], references: [id], onDelete: Cascade)
    calendarId String
}
