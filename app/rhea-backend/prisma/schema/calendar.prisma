model Calendar {
    id        String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt
    position  Int      @default(0)

    originTime BigInt @default(0)

    name          String
    units         CalendarUnit[]
    seasons       CalendarSeason[]
    presentations CalendarPresentation[]

    dateFormat String?

    // A calendar is owned by either a world or a user, and never both
    world   World?  @relation(fields: [worldId], references: [id], onDelete: Cascade)
    owner   User?   @relation(fields: [ownerId], references: [id], onDelete: Cascade)
    worldId String?
    ownerId String?
}

model CalendarUnit {
    id        String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt
    position  Int      @default(0)

    name              String
    displayName       String?
    displayNameShort  String?
    displayNamePlural String?

    formatMode      CalendarUnitFormatMode     @default(Name)
    formatShorthand String?
    negativeFormat  CalendarUnitNegativeFormat @default(MinusSign)

    duration  BigInt @default(1)
    treeDepth Int    @default(1)

    calendar   Calendar @relation(fields: [calendarId], references: [id], onDelete: Cascade)
    calendarId String

    parents       CalendarUnitRelation[]     @relation("ChildUnit")
    children      CalendarUnitRelation[]     @relation("ParentUnit")
    presentations CalendarPresentationUnit[]
}

model CalendarUnitRelation {
    id        String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    label    String?
    repeats  Int     @default(1)
    position Int     @default(0)

    parentUnit   CalendarUnit @relation("ParentUnit", fields: [parentUnitId], references: [id], onDelete: Cascade)
    childUnit    CalendarUnit @relation("ChildUnit", fields: [childUnitId], references: [id], onDelete: Cascade)
    parentUnitId String
    childUnitId  String
}

enum CalendarUnitFormatMode {
    // Month 0
    Name
    // Month 1
    NameOneIndexed
    // 0
    Numeric
    // 1
    NumericOneIndexed
    // Not displayed
    Hidden
}

enum CalendarUnitNegativeFormat {
    MinusSign
    AbsoluteValue
}

/**
 * Calendar presentations
 */
model CalendarPresentation {
    id        String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    name        String
    compression Float  @default(1.0)

    scaleFactor Float                      @default(1.0)
    units       CalendarPresentationUnit[]

    calendar   Calendar @relation(fields: [calendarId], references: [id], onDelete: Cascade)
    calendarId String
}

model CalendarPresentationUnit {
    id        String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    name         String
    formatString String
    subdivision  Int    @default(1)

    unit   CalendarUnit @relation(fields: [unitId], references: [id], onDelete: Cascade)
    unitId String

    presentation   CalendarPresentation @relation(fields: [presentationId], references: [id], onDelete: Cascade)
    presentationId String
}

/**
 * Seasons
 */
model CalendarSeason {
    id        String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt
    position  Int

    name            String
    formatShorthand String?

    intervals CalendarSeasonInterval[]

    calendar   Calendar @relation(fields: [calendarId], references: [id], onDelete: Cascade)
    calendarId String
}

model CalendarSeasonInterval {
    id        String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    leftIndex  Int
    rightIndex Int

    season   CalendarSeason @relation(fields: [seasonId], references: [id], onDelete: Cascade)
    seasonId String
}
